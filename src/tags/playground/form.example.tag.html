<form-example>
  <form class="form-horizontal" onsubmit={ submit } if={!success}>
    <div class={{'form-group': true, 'has-error': errors.username}}>
      <input class="form-input" name="username" type="text" placeholder="Name" autocomplete="off">
      <p class="form-input-hint" each={error in errors.username}>{error}</p>
    </div>
    <div class={{'form-group': true, 'has-error': errors.email}}>
      <input class="form-input" name="email" type="email" placeholder="Email" autocomplete="off">
      <p class="form-input-hint" each={error in errors.email}>{error}</p>
    </div>
    <div class={{'form-group': true, 'has-error': errors.password1}}>
      <input class="form-input" name="password1" type="password" placeholder="Password" autocomplete="off">
      <p class="form-input-hint" each={error in errors.password1}>{error}</p>
    </div>
    <div class={{'form-group': true, 'has-error': errors.password2}}>
      <input class="form-input" name="password2" type="password" placeholder="Repeat password" autocomplete="off">
      <p class="form-input-hint" each={error in errors.password2}>{error}</p>
    </div>
    <div class={{'form-group': true, 'has-error': errors.agree}}>
        <label class="form-switch">
          <input type="checkbox" name="agree">
          <i class="form-icon"></i> 
          I agree with terms and conditions.
        </label>
        <p class="form-input-hint" each={error in errors.agree}>{error}</p>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary">Register</button>
    </div>
  </form>
  <div class="empty" if={success}>
    <div class="empty-icon">
      <i class="icon icon-3x icon-mail"></i>
    </div>
    <p class="empty-title h5">Thank you!</p>
    <p class="empty-subtitle">Please check your inbox for confirmation link.</p>
    <div class="empty-action">
      <button class="btn btn-primary"> &larr; Back </button>
    </div>
  </div>
  <script>
    import client from 'lib/client';

    this._id = 'form-example';
    this.errors = {}; // server sent state
    this.success = false; // server sent state

    this.submit = function(ev) {
      ev.preventDefault();
      client.service('playground/form-example').create(this.form(ev.target))
    }

    
    // reset error states on user input
    this.on('mount', ()=>{
      if (this.isClient()) {
        const groups = Array.from(this.root.querySelectorAll('.form-group input'));

        groups.map((el) => {
          el.addEventListener('keyup', ()=> {
            delete this.errors[el.name];
            this.update();
          })

          if (el.type==='checkbox')
          el.parentNode.addEventListener('mouseup', ()=> {
            delete this.errors[el.name];
            this.update();
          });
        });
      }
    })

  </script>
  <style>
    :scope .form-input-hint {
      margin-bottom: 0px;
      display: none;
    }
    :scope .has-error .form-input-hint {
      display: inline-block;
      margin-right: 12px;
    }
  </style>
</form-example>
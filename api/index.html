<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>API - RiotJS Isomorphic Stack</title>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "API";
    var mkdocs_page_input_path = "api.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <!-- Place this tag in your head or just before your close body tag. -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">

    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <!-- <br> -->
        <img src="../img/logo-white.png" class="normal-img" style="width: 80% !important;"/>
        <!-- <a href=".." class="icon icon-home"> RiotJS Isomorphic Stack</a> -->
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../server_rendering/">SSR</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../routing/">Routing</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">API</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#feathersjs-client">FeathersJS Client</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#services">Services</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mongodb">MongoDB</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#request-context">Request context</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sessions">Sessions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cors">CORS</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#auth">Auth</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#security">Security</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/">Utils</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../plugins/">Plugins</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../config/">Configuration</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">RiotJS Isomorphic Stack</a>
      </nav>
      
      
      
      <div class="wy-nav-content">
        
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>API</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/nesterow/frontless-docs/edit/master/docs/api.md"
        data-icon="octicon-eye"
        data-size="small"
          class="github-button"> Edit on GitHub</a>
      
      <a class="github-button" href="https://github.com/nesterow/frontless" data-size="small" data-show-count="true" aria-label="Star Frontless on GitHub">
          Star
      </a>
      <!-- Place this tag where you want the button to render. -->
      <!-- <a class="github-button" href="https://github.com/nesterow/frontless/fork" data-icon="octicon-repo-forked" data-size="small" aria-label="Fork ntkme/github-buttons on GitHub">Fork</a> -->
      <!-- <a href="https://h5l5o.sse.codesandbox.io/" target="_blank" >
        <img src="https://img.shields.io/badge/CodeSandbox-â–¶-green.svg"></img>
      </a> -->
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="api">API</h1>
<p>Out of the box Frontless provides user sessions, a MongoDB connection and user authentication strategy with FeathersJS. </p>
<h2 id="feathersjs-client">FeathersJS Client</h2>
<p>To achieve universal behaviour on server and client Frontless utilizes <a href="https://docs.feathersjs.com/api/client.html">Feathers Client</a>.</p>
<p><strong>Unauthorized Client:</strong></p>
<pre><code class="javascript">  import 'client' from 'client'
  const Model = client.service('/myservice')
  Model.create({message: 'hello!'}).then((res)=&gt;{
    alert('Message created!')
  })
</code></pre>

<p><strong>Authotized Client:</strong></p>
<p>The <code>client</code> property in a RiotJS component context sends authorized requests on client and server.</p>
<pre><code class="javascript">export default {
  createItem(data){
    const Model = this.client.service('items')
    Model.create(data)
  }
}
</code></pre>

<h2 id="services">Services</h2>
<p>A service is a set of CRUD methods. In Frontless services can be accessed whether with REST client or Socket.IO
<a href="https://github.com/feathersjs/docs/blob/master/api/services.md">Feathers readme on services</a></p>
<p>Example:</p>
<pre><code class="javascript">const {MONGO_DATABASE} = process.env

module.exports = (app, mongo) =&gt; {

  const Model =  mongo.db(MONGO_DATABASE).collection('mydata')

  app.use('myservice', {

    async find() {
      return []
    },

    async get() {
      return {}
    },

    async create() {
      return {}
    },

    async update() {
      return []
    },

    async remove() {
      return []
    },

  })


  app.service('myservice').hooks({
    before: {
     create: [
     ],
     remove: [
     ]
    }
   });

}

</code></pre>

<h2 id="mongodb">MongoDB</h2>
<p>At initialization Frontless tries to connect to MongoDB server using <code>MONGODB_URI</code> variable.</p>
<p>Frontless does not provide an ODM out of the box, but connecting one is as easy as in any node.js application. 
Instead we suggesst to consider following Feathers features:</p>
<ol>
<li><a href="https://github.com/feathersjs/docs/blob/master/api/databases/querying.md">Fetthers Querying</a></li>
<li><a href="https://github.com/feathersjs-ecosystem/feathers-mongodb">Feathers JS MongoDB Plugin</a></li>
</ol>
<h2 id="request-context">Request context</h2>
<p>On the server side every RiotJS component has access to express.js context. 
<code>req</code> and <code>res</code> are passed to the <code>fetch</code> method with other props. Also <code>this.req</code> and <code>this.res</code> are available in component context. </p>
<p>Example:</p>
<pre><code class="javascript">export default {
  async fetch({req, res}){
    //use req, res
  },

  aMethod(){
    const {req, res} = this;
  }
}
</code></pre>

<h2 id="sessions">Sessions</h2>
<p>Express.js session middleware provides sessions.</p>
<p>Accessing within services:</p>
<pre><code class="javascript">app.use('increment', {
    // enter chat with nickname
    async get(number, params) {
      params.request.session['number'] = parseInt(number) + 1;
      params.request.session.save();
      return {};
    }
})
</code></pre>

<h2 id="cors">CORS</h2>
<p>Allowed origins are stored in the <code>ALOWED_HOSTS</code> environment variable. Beware, by deafult all hosts are allowed which is not recommended on an production deploy.</p>
<h2 id="auth">Auth</h2>
<p>Frontless utilizes <a href="https://docs.feathersjs.com/api/authentication/local.html">@feathersjs/authentication-local</a> module to provide authentication strategy for your applications. The authentication token is stored in cookies so it is mandatory to use CORS and HTTPS if your app has restricted areas.</p>
<p>Example:</p>
<pre><code class="javascript">this.client.authenticate({
  strategy: 'local',
  username,
  password,
}).

then((res) =&gt; {
  return this.client.passport.verifyJWT(res.accessToken)
}).

then((res) =&gt; {
  this.redirect('/profile')
}).

catch((err) =&gt; {  
  console.log(err)
})
</code></pre>

<h2 id="security">Security</h2>
<ol>
<li>Beware that all components including pages are compiled for browser as well. So it is NOT recommended to use sensitive variables or use any sentive data as open text inside your riot components</li>
<li>When working with Riot Components, is is HIGHLY recommended to use functional approach. Every component should be returned from a function like export default ()=&gt; ({...component}). This is needed to avoid <a href="https://nodejs.org/api/modules.html#modules_caching">module caching</a></li>
<li>Under no circumstances, It is NOT recommended to turn off the CORS middlewares or use <code>*</code> on production deploys.</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../utils/" class="btn btn-neutral float-right" title="Utils">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../routing/" class="btn btn-neutral" title="Routing"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/nesterow/frontless-docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../routing/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../utils/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script type="text/javascript" defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
